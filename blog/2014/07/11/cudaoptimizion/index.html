
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>cuda 优化 - 零露漙兮</title>
	<meta name="author" content="luoyulong">

	
	<meta name="description" content="Cuda 优化 发现一个很神奇的问题：在访问global memory时，我做coalescing 优化后，global efficiency 提升到100%，但是global memory thoughtput下降，性能也下降了。对于这个现象，我首先搜了下这两者的关系： &ldquo; &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="零露漙兮" type="application/atom+xml">
	
	<link rel="canonical" href="http://luoyulong.github.io/blog/2014/07/11/cudaoptimizion/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<!--link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'-->
  	<!--script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script-->
	
  

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
  <img src="/images/avatar.jpg" alt="Profile Picture" style="width: 160px;" />
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
	</script>
</div>

<nav id="main-nav">
<section class="aboutme">
  <h1><a href="/">
 零露漙兮BLOG
 </a></h1>
  <p>
    A blogging for high performance optimizing study.
  </p>
</section>
<ul class="main">
    <li><a href="/">博客</a></li>
    <li><a href="/blog/archives">文章列表</a></li>
</ul>


</nav>
<nav id="sub-nav">
	<div class="social">
		
			<a class="email" href="mailto:luoyulong@ncic.ac.cn" title="Email">Email</a>
		
		
			<a class="facebook" href="http://www.facebook.com/yulong.luo.1" title="Facebook">Facebook</a>
		
		
		
		
			<a class="github" href="https://github.com/luoyulong" title="GitHub">GitHub</a>
		
		
		
		
			<a class="linkedin" href="http://www.linkedin.com/in/luoyulong" title="LinkedIn">LinkedIn</a>
		
		
		
		
		
		
		
    	
    	
			<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">Cuda 优化</h1>
	<div class="entry-content" itemprop="articleBody"><ul>
<li><p>发现一个很神奇的问题：在访问global memory时，我做coalescing 优化后，global efficiency 提升到100%，但是global memory thoughtput下降，性能也下降了。对于这个现象，我首先搜了下这两者的关系：</p>

<blockquote><p>&ldquo;Global Load Efficiency and Global Store Efficiency describe how well the coalescing of DRAM-accesses and (L2?)Cache-accesses works. If they&rsquo;re 100 percent then you&rsquo;ve got perfect coalescing. Since efficiencies above 100 percent don&rsquo;t make any sense (you cannot be better than optimal) this has to be an error. This error is caused by the Visual Profiler, which counts hardware events to calculate some abstract metrics. But the GPU doesn&rsquo;t have the &#8220;correct&rdquo; events to exactly calculate all those metrics, thus Visual Profiler has to estimate those metrics by using some complex formula and &ldquo;wrong&rdquo; events. There are some metrics which are just rough estimations and Global Load Efficiency and Global Store Efficiency are two of them. Thus if such an efficiency is bigger than 100 percent it is an estimation error. As far as I observed the Global Load Efficiency and Global Store Efficiency both increased above 100 percent in some of my register spilling kernels. That&rsquo;s why i assume that the Visual-Profiler uses some events, which also may be caused by local memory accesses, to calculate those two efficiencies. Furthermore GPUs just uses 32 Bit Counters. Thus long running kernel tend to overflow those counters, which also causes the Visual Profiler to display wrong metrics.&#8221;</p></blockquote></li>
<li><p>这段话感觉没什么建设性意义。。。</p></li>
<li><p>然后我忽然发现occupancy很低，我想会不会访存不是瓶颈呢？ 即是说每次请求的效率很高，但是单位时间内发出的请求数很低，导致了总输出低？
做了一个实验，调整了分块大小，结果性能提高了，global memory thoughtput大幅提升，但Global Load Efficiency不变。感觉自己的猜想有可能正确。</p></li>
</ul>

</div>

</article>


	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>




<section><h1>Comments</h1><div id="comments" aria-live="polite">
<!-- Duoshuo Comment BEGIN -->
<div class="ds-thread">
</div><script type="text/javascript"> 
var duoshuoQuery = {short_name:"linglublog"}; 
(function() {    var ds = document.createElement('script'); 
 ds.type = 'text/javascript';ds.async = true;  
 ds.src = 'http://static.duoshuo.com/embed.js';  
 ds.charset = 'UTF-8';  
 (document.getElementsByTagName('head')[0]     || document.getElementsByTagName('body')[0]).appendChild(ds);  })();
 </script>
<!-- Duoshuo Comment END -->
 </div> 
</section>

</div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2014

    luoyulong


Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
		</div>
	</div>
	









<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F827d87586e82cbe94424561664edd024' type='text/javascript'%3E%3C/script%3E"));
</script>



</body>
</html>

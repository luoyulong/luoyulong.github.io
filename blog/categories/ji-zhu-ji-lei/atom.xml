<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: 技术积累 | 零露漙兮]]></title>
  <link href="http://luoyulong.github.io/blog/categories/ji-zhu-ji-lei/atom.xml" rel="self"/>
  <link href="http://luoyulong.github.io/"/>
  <updated>2014-07-03T09:36:19+08:00</updated>
  <id>http://luoyulong.github.io/</id>
  <author>
    <name><![CDATA[luoyulong]]></name>
    <email><![CDATA[luoyulong@ncic.ac.cn]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[CUDA 计时的方法]]></title>
    <link href="http://luoyulong.github.io/blog/2014/07/02/cuda-timing/"/>
    <updated>2014-07-02T15:04:09+08:00</updated>
    <id>http://luoyulong.github.io/blog/2014/07/02/cuda-timing</id>
    <content type="html"><![CDATA[<h1>问题</h1>

<p>测试CUDA应用的时间</p>

<h1>解决方案</h1>

<p>引用自stackoverflow：</p>

<blockquote><p>You could do sth along the lines of :</p></blockquote>

<p>``` cuda</p>

<h1>include&lt;sys/time.h></h1>

<p>struct timeval t1, t2;</p>

<p>gettimeofday(&amp;t1, 0);</p>

<p>kernel_call&lt;&lt;&lt;dimGrid, dimBlock, 0>>>();</p>

<p>HANDLE_ERROR(cudaThreadSynchronize();)</p>

<p>gettimeofday(&amp;t2, 0);</p>

<p>double time = (1000000.0*(t2.tv_sec-t1.tv_sec) + t2.tv_usec-t1.tv_usec)/1000000.0;</p>

<p>printf(&ldquo;Time to generate:  %3.1f ms \n&rdquo;, time);
<code>
or:
</code>
float time;
cudaEvent_t start, stop;</p>

<p>HANDLE_ERROR( cudaEventCreate(&amp;start) );
HANDLE_ERROR( cudaEventCreate(&amp;stop) );
HANDLE_ERROR( cudaEventRecord(start, 0) );</p>

<p>kernel_call&lt;&lt;&lt;dimGrid, dimBlock, 0>>>();</p>

<p>HANDLE_ERROR( cudaEventRecord(stop, 0) );
HANDLE_ERROR( cudaEventSynchronize(stop) );
HANDLE_ERROR( cudaEventElapsedTime(&amp;time, start, stop) );</p>

<p>printf(&ldquo;Time to generate:  %3.1f ms \n&rdquo;, time);
```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ROSE 在源文件的include语句之前插入语句]]></title>
    <link href="http://luoyulong.github.io/blog/2014/07/01/rose-insertstatementbeforeheader/"/>
    <updated>2014-07-01T11:50:40+08:00</updated>
    <id>http://luoyulong.github.io/blog/2014/07/01/rose-insertstatementbeforeheader</id>
    <content type="html"><![CDATA[<h1>问题</h1>

<p>今天，在使用ROSE自动生成CUDA代码时，遇到一个问题：程序中需要使用纹理存储器对GPU访存进行加速，相应地要生成texture变量声明的代码。由于texture初始化时使用到一个宏，该宏定义在文件头部，这就使得texture的初始化必须在宏定义之后。翻遍了手册，找不到把语句插入preprocessinfo 结点（include，#define ）之后的方法，于是退一步打算找到当前scope中第一个语句，然后插到该语句之后。本打算调用firststatement的方法，报错，并且scope中的statement并不全是源码中的语句，会包含一些头文件中的结点。</p>

<h1>解决方法</h1>

<p>通过比较scope和scope中语句的名字，找到当前源文件中第一个SgStatement
``` c++
 //find the first statement of current source file
  SgStatement<em> firststatement=NULL;
  SgStatementPtrList statelist=currentscope->generateStatementList();
  for(int i=0;i&lt;statelist.size();i++)
  {
  SgStatement</em> tmp=statelist[i];
  if(tmp->get_file_info()&ndash;>get_filenameString()==currentscope->get_file_info()&ndash;>get_filenameString())</p>

<pre><code>{
firststatement=tmp;
break;
}
</code></pre>

<p>   }</p>

<pre><code>                                                                 }
</code></pre>

<p>```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[检测Linux下 ODBC是否配置成功]]></title>
    <link href="http://luoyulong.github.io/blog/2014/06/30/linuxodbc/"/>
    <updated>2014-06-30T21:48:21+08:00</updated>
    <id>http://luoyulong.github.io/blog/2014/06/30/linuxodbc</id>
    <content type="html"><![CDATA[<h1>问题</h1>

<p>测试ODBC安装是否成功</p>

<h1>解决方案</h1>

<p>使用isql测试数据源是否配置正确
``` bash</p>

<h1>dbname:the username of target database</h1>

<h1>dbpsw: the password of target database</h1>

<p>imysql -v datasourcename dbname dbpsw
```
如果数据源配置正确，会出现进入数据库</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ROSE 创建模板类变量的一个取巧办法]]></title>
    <link href="http://luoyulong.github.io/blog/2014/06/30/rose-create-template-variable/"/>
    <updated>2014-06-30T09:42:36+08:00</updated>
    <id>http://luoyulong.github.io/blog/2014/06/30/rose-create-template-variable</id>
    <content type="html"><![CDATA[<h1>问题</h1>

<p>用ROSE产生cuda代码时，为了性能需要，使用到了纹理存储器。但在纹理存储器变量声明的时候，遇到了点问题：纹理寄存器变量的类型是模板类实例，e.g,<code>texture&lt;DATATYPE,1,cudaReadModeElementType&gt; t_a</code>,但是rose中模板类变量貌似不怎么好声明，尝试了半天都没有成功。</p>

<h1>解决方案</h1>

<p>使用万金油式的buildOpaqueType直接创建模板类型,然后使用该类型创建纹理存储器变量</p>

<p>``` c++</p>

<p>//create a template instance type directly: texture&lt;DATATYPE,1,cudaReadModelElementType>
SgType* textureType=buildOpaqueType(&ldquo;texture&lt;DATATYPE,1,cudaReadModelElementType>&rdquo;,node->get_scope());</p>

<p>//create the texture type variable &ldquo;texture_a&rdquo;
SgVariableDeclaration* vdecl=buildVariableDeclaration(&ldquo;texture_a&rdquo;,textureType,node->get_scope());</p>

<p>```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[error: no instance of overloaded function "tex1Dfetch" matches the argument list argument types are: (texture<double, 1, cudaReadModeElementType>, int)  ]]></title>
    <link href="http://luoyulong.github.io/blog/2014/06/29/cudatexture/"/>
    <updated>2014-06-29T15:59:52+08:00</updated>
    <id>http://luoyulong.github.io/blog/2014/06/29/cudatexture</id>
    <content type="html"><![CDATA[<h1>问题</h1>

<p>在使用cuda的纹理存储器时，编译器报错
<code>bash
stencilexample.cu(147): error:
no instance of overloaded function "tex1Dfetch"
matches the argument list argument types are:
(texture&lt;double, 1, cudaReadModeElementType&gt;, int)
</code></p>

<h1>解决方法</h1>

<p>经过研究，发现原来cuda的纹理存储器不能直接支持double</p>

<blockquote><p>The type of a texel, which is restricted to the basic integer and single-precision floating-point types and any of the 1-, 2-, and 4-component vector types defined in char, short, int, long, longlong, float, double that are derived from the basic integer and single-precision floating-point types.
出处：<a href="http://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#texture-and-surface-memory" title="Title">cuda-c-programming-guide</a></p></blockquote>

<p>非要加速的话，可以使用一个int2类型的向量拼接成一个double
``` cuda
//declarate the texture using int2 type
texture &lt;int2,1,cudaReadModeElementType> Atex;</p>

<p>//used in global function(cuda kernel)
int2 A1=tex1Dfetch(Atex,(texoff+(ll+offset) <em>lda +ty+offset));
Bs[ty+offset][tx] &ndash;= __hiloint2double(A1.y,A1.x)</em>temp;</p>

<p>```</p>
]]></content>
  </entry>
  
</feed>
